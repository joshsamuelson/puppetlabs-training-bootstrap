{
  "builders": [
    {
      "type":"docker",
      "image":"centos:7",
      "commit":"true",
      "run_command":[
        "-d", "-i", "-t",
        "--security-opt", "seccomp=unconfined",
        "--restart=always",
        "--tmpfs", "/tmp",
        "--tmpfs", "/run",
        "{{.Image}}", "/usr/lib/systemd/systemd"
      ]
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "inline": [
        "useradd training",
        "echo \"training:training\" | chpasswd",
        "echo \"training ALL=(ALL) NOPASSWD: ALL\" >> /etc/sudoers",
        "mkdir -p /training/file_cache",
        "mkdir -p /usr/src/build_files",
        "chown -R training:training /training"]
    },
    {
      "type": "file",
      "source": "file_cache/",
      "destination": "/training/file_cache"
    },
    {
      "type": "file",
      "source": "build_files/",
      "destination": "/usr/src/build_files"
    },
    {
      "execute_command": "{{.Vars}} \"PATH=$PATH\"",
      "environment_vars": [
        "PE_STATUS={{user `pe_status`}}",
        "PE_VERSION={{user `pe_version`}}",
        "PRE_RELEASE={{user `pre_release`}}",
        "PE_FAMILY={{user `pe_family`}}",
        "RUBY_LIB={{user `rubylib`}}",
        "TRAINING_REPO={{user `training_repo`}}",
        "TRAINING_BRANCH={{user `training_branch`}}",
        "VM_TYPE={{user `vm_type`}}"
      ],
      "scripts": [
        "scripts/base.sh",
        "scripts/vbox.sh",
        "scripts/time.sh",
        "scripts/pre_build.sh",
        "scripts/{{ user `vm_type` }}_pre_build.sh",
        "scripts/cleanup.sh"
      ],
      "type": "shell"
    }
  ],
  "variables": {
    "hostname": "training",
    "vm_type": "training",
    "vm_memsize": "4096",
    "vm_disk_size": "20480",
    "vm_cores": "2",
    "pe_version": "2016.5.1",
    "ptb_version": ""
  }
}
